<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–∂–≤–∞—á–∫–∞ –º–µ–¥–æ–µ–¥ ‚Äî –ø—Ä–∏—ë–º –∏ –ø—Ä–æ–¥–∞–∂–∞</title>
<style>
:root{
  --bg:#0f1116; --panel:#151a24; --panel2:#121622; --line:#262a3b;
  --ink:#e8e8ee; --muted:#a6a8b6; --gold:#ffb84d; --good:#74dfb2; --bad:#ff7d7d;
}
*{box-sizing:border-box}
html,body{margin:0;background:radial-gradient(1100px 800px at 70% -10%,#1b1e28 0%,var(--bg) 60%),var(--bg);color:var(--ink);font-family:Inter,ui-sans-serif,system-ui}
header{position:sticky;top:0;z-index:10;background:rgba(12,14,20,.65);backdrop-filter:blur(8px);border-bottom:1px solid #22283b}
.bar{max-width:860px;margin:0 auto;padding:10px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px}
.stats{display:flex;gap:10px;flex-wrap:wrap}
.badge{background:linear-gradient(180deg,#1b1e29,#151823);border:1px solid var(--line);border-radius:12px;padding:6px 10px}
.wrap{max-width:860px;margin:18px auto;padding:0 14px;display:grid;gap:12px}
.panel{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:14px;padding:14px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{appearance:none;background:#1b2030;border:1px solid #2a2f44;color:var(--ink);padding:12px 18px;border-radius:12px;cursor:pointer;font-weight:700}
.btn:active{transform:translateY(1px)}
.btn.primary{background:linear-gradient(180deg,#2a2116,#1d170f);border-color:#3e2d12;color:#ffdca8}
.btn.good{background:linear-gradient(180deg,#143222,#0f1f18);border-color:#1f4b33;color:#c9f7e4}
.btn[disabled]{opacity:.55;cursor:not-allowed}
.separator{height:1px;background:#222739;margin:12px 0}

/* –ø—Ä–æ–≥—Ä–µ—Å—Å */
.progress{height:10px;background:#0f1117;border:1px solid #23283b;border-radius:999px;overflow:hidden}
.progress .bar{height:100%;width:0;background:linear-gradient(90deg,#4d3a1f,#ffb84d)}

/* –¥–∏–∞–ª–æ–≥–æ–≤—ã–π –±–ª–æ–∫ */
.portrait{font-size:44px;border:1px solid #23283b;border-radius:12px;padding:12px;min-width:64px;text-align:center;background:#0f1219}
.meta{display:flex;gap:8px;flex-wrap:wrap}
.pill{padding:4px 10px;border:1px solid var(--line);border-radius:999px;background:#141927;color:#9da1b1;font-size:12px}
.dialog{background:#0f1117;border:1px solid #23283b;border-radius:12px;padding:10px;line-height:1.4}
.hint{color:#9da1b1;font-size:13px}

/* –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∫–ª–∞–º—ã */
.answers{display:grid;gap:8px}
.answer{background:#0f1219;border:1px solid #23283b;border-radius:10px;padding:10px;cursor:pointer}
.answer input{margin-right:8px;accent-color:var(--gold)}
.answer:hover{border-color:#3a2a12}

/* –∂—É—Ä–Ω–∞–ª */
.log{display:grid;gap:8px;max-height:260px;overflow:auto}
.item{background:#0f1219;border:1px solid #23283b;border-radius:10px;padding:8px}
.item .who{opacity:.85}
.ok{color:var(--good)} .no{color:var(--bad)}

/* –º–æ–¥–∞–ª */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:20}
.modal.show{display:flex}
.sheet{background:#12131a;border:1px solid #2a2b35;border-radius:14px;max-width:560px;width:100%;padding:16px}
.sheet h2{color:#ffdca8;margin:0 0 6px}
.sheet p{margin:6px 0 0}
@media (max-width:560px){
  .bar{flex-direction:column;align-items:flex-start}
}
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="stats">
      <div class="badge">üßÉ –ó–∞–ø–∞—Å: <b id="stock">10</b></div>
      <div class="badge">üí∞ –î–µ–Ω—å–≥–∏: <b id="cash">20</b> ‚ÇΩ</div>
      <div class="badge">‚úÖ –°–¥–µ–ª–∫–∏: <b id="wins">0</b>/10</div>
    </div>
    <div class="stats" style="min-width:240px;flex:1">
      <div style="flex:1;min-width:220px">
        <div class="progress" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å –∫ —Ü–µ–ª–∏">
          <div class="bar" id="winBar"></div>
        </div>
        <div class="hint" id="winHint">–¶–µ–ª—å: 10 —É–¥–∞—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂</div>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- –í–µ—Ä—Ö–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è -->
  <section class="panel" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div class="row">
        <button class="btn" id="btnAccept" title="Enter">–ü—Ä–∏–Ω—è—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞</button>
        <button class="btn primary" id="btnSell" title="–ü—Ä–æ–±–µ–ª" disabled>–ü—Ä–æ–¥–∞—Ç—å –º–µ–¥–æ–µ–¥</button>
      </div>
      <button class="btn good" id="btnReveal" disabled>–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ</button>
    </div>
    <div class="hint" style="margin-top:6px">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–Ω–∞—á–∞–ª–∞ ¬´–ü—Ä–∏–Ω—è—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞¬ª, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏ —Ä–µ–∫–ª–∞–º—É –∏ –∂–º–∏ ¬´–ü—Ä–æ–¥–∞—Ç—å –º–µ–¥–æ–µ–¥¬ª. Enter/Space —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–∂–µ.</div>
  </section>

  <!-- –î–∏–∞–ª–æ–≥ –∏ –≤—ã–±–æ—Ä —Ä–µ–∫–ª–∞–º—ã -->
  <section class="panel" aria-label="–î–∏–∞–ª–æ–≥">
    <div class="row" style="align-items:flex-start">
      <div class="portrait" id="portrait">üôÇ</div>
      <div style="flex:1">
        <div class="meta">
          <span class="pill" id="ptype">–ü–∞—Ü–∏–µ–Ω—Ç: ‚Äî</span>
          <span class="pill" id="prefs">‚Äî</span>
        </div>
        <div class="dialog" id="dialog">–ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–∏–Ω—è—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞¬ª. –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –µ–≥–æ —Ä–µ–ø–ª–∏–∫–∞.</div>
      </div>
    </div>

    <div class="separator"></div>

    <div>
      <div class="row" style="justify-content:space-between;align-items:end">
        <div style="font-weight:700">–†–µ–∫–ª–∞–º–∞ –º–µ–¥–æ–µ–¥–∞ (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É)</div>
        <div class="hint" id="adHint">–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Å—Ç–∏–ª–µ–º, –Ω–æ –æ–¥–Ω–∞ ¬´—Å—É—Ç—å¬ª –∑–∞–π–¥—ë—Ç —ç—Ç–æ–º—É —Ç–∏–ø—É.</div>
      </div>
      <div class="answers" id="answers"><!-- —Ä–∞–¥–∏–æ-–æ–ø—Ü–∏–∏ —Å—é–¥–∞ --></div>
    </div>
  </section>

  <!-- –ñ—É—Ä–Ω–∞–ª -->
  <section class="panel" aria-label="–ñ—É—Ä–Ω–∞–ª">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div style="font-weight:700">–ñ—É—Ä–Ω–∞–ª –¥–∏–∞–ª–æ–≥–æ–≤</div>
      <div class="hint">–ü–æ—Å–ª–µ —É–¥–∞—á–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ –≤ –∂—É—Ä–Ω–∞–ª –ø–∏—à–µ—Ç—Å—è: –≤–∞—à–∞ —Ñ—Ä–∞–∑–∞ –∏ –æ—Ç–≤–µ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è.</div>
    </div>
    <div class="log" id="log"></div>
  </section>
</main>

<!-- –ü–æ—Å–ª–∞–Ω–∏–µ -->
<div class="modal" id="modal">
  <div class="sheet">
    <h2>–ü–æ–¥–∞—Ä–æ–∫</h2>
    <p id="loveText">–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ç–≤–æ—ë –ø–æ—Å–ª–∞–Ω–∏–µ. ‚ú®</p>
    <div style="display:flex;justify-content:center;margin-top:10px">
      <button class="btn primary" id="close">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<script>
/* ===== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ===== */
const LOVE_MESSAGE = '–Ø –ª—é–±–ª—é —Ç–µ–±—è, –õ–µ–Ω–∞ ‚ù§Ô∏è'; // —Ç–≤–æ–π —Ç–µ–∫—Å—Ç
const START_STOCK = 12; // –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–ø–∞—Å, –æ–±—ã—á–Ω–æ —Ö–≤–∞—Ç–∏—Ç –Ω–∞ 10 —É—Å–ø–µ—à–Ω—ã—Ö

/* –ü—Å–∏—Ö–æ—Ç–∏–ø—ã (–±–µ–∑ –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞) */
const TYPES = {
  vurdalak: {
    name:'–í—É—Ä–¥–∞–ª–∞–∫', emoji:'üßõ',
    likes:['–Ω–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å','—Å–ª–∞–±–æ—É–º–∏–µ'],
    greet:[
      '¬´–í–ê–ê–ê–ê–ê–ê–ê–ê–ô –ë–õ–Ø!! –ñ–≤–∞—á–∫—É –¥–∞–π —à–µ—Ä–∏—Ñ—ã –∑–∞–µ–±–∞–ª–∏!¬ª',
      '¬´–î–ê–ô –ñ–í–ê–ß–ö–£ –°–ï–ô–ß–ê–° –ù–ê –ü–£–ó–û –ü–û–õ–û–ñ–£ –ù–ê–•–£–ô¬ª',
      '¬´–†–∞—Å—Ö—É—è—Ä–∏–ª –¥–µ—Å—è—Ç—å —à–µ—Ä–∏—Ñ–æ–≤, –¥–∞–π —Ö–∞–ø–∞–Ω—É—Ç—å¬ª'
    ],
    ok:[
      '¬´–û –ë–†–ê–¢–ê–ù –°–ü–ê–°–ò–ë–û!¬ª',
      '¬´–û–ô –•–ê–ü–ê–ù–£–õ –¢–ê–ö –•–ê–ü–ê–ù–£–õ¬ª',
      '¬´–®–ï–†–ò–§–´ –õ–Ø–ì–£–¢ –ù–ê –ü–£–ó–û –ê–•–ê–•–ê–•–ê–•–•–ê¬ª'
    ],
    no:[
      '¬´–¢—É–º–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ ‚Äî –Ω–µ –º–æ—ë.¬ª',
      '¬´–ú–Ω–æ–≥–æ —à—É–º–∞, –º–∞–ª–æ —Ç–æ–ª–∫—É.¬ª',
      '¬´–ú–∏–º–æ. –•–æ—Ç–µ–ª —á—ë—Ç–∫–æ –∏ –∫–æ—Ä–æ—Ç–∫–æ.¬ª'
    ],
    want:'power'
  },
  social: {
    name:'–ê–≤–∞—Ç–∞—Ä–∏–∫', emoji:'üè†',
    likes:['—Å–æ—Ü–∏–∞–ª–∏—Ç—å','–∞–≤–∞—Ç–∞—Ä–∏—Ç—å'],
    greet:[
      '¬´–ú–æ—è –º—É—Ä—á–∞–ª–∫–∞ –∑–∞—Ö–æ—Ç–µ–ª–∞ –∂–≤–∞—á–∫–∏, –º–æ–∂–Ω–Ω–æ?¬ª',
      '¬´–•–æ—á—É –ø–æ–º—É—Ä—á–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è —Å –º–æ–µ–π –∫—Ä–∞–ª–µ–π, —á—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—Ç–µ?¬ª',
      '¬´–•–æ—á—É –±—ã—Ç—å –∫—Ä—É—Ç–æ–π –ø–µ—Ä–µ–¥ –º–æ–µ–π –±—É–ª–æ—á–∫–æ–π, —á—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—Ç–µ?¬ª'
    ],
    ok:[
      '¬´–°–ü–ê–°–ò–ë–û –ë–ï–†–£!!!¬ª',
      '¬´–£–∂–µ —á—É–≤—Å—Ç–≤—É—é —Ç–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω –≤ –≤–µ–Ω–∞—Ö!¬ª',
      '¬´–£–• –¢–´!¬ª'
    ],
    no:[
      '¬´–ó–≤—É—á–∏—Ç –∫–∞–∫ –¥–µ—à–µ–≤–∞—è —Ä–µ–∫–ª–∞–º–∞. –ù–µ—Ç.¬ª',
      '¬´–õ–∏—à–Ω–∏–µ —Å–ª–æ–≤–∞ –Ω–µ –ø–æ–º–æ–≥–∞—é—Ç.¬ª',
      '¬´–£—Ö–æ–∂—É. –ù–µ –º–æ–π —Å—Ç–∏–ª—å.¬ª'
    ],
    want:'charisma'
  },
  arist: {
    name:'–ê—Ä–∏—Å—Ç–æ–∫—Ä–∞—Ç', emoji:'üé©',
    likes:['–∂–∏—Ç—å –≤–µ—á–Ω–æ','–¥–µ–Ω—å–≥–∏','—Å–ª–∞–≤–∞'],
    greet:[
      '¬´–Ø —Å–ª—ã—à–∞–ª –º–µ–¥–æ–µ–¥ –ø—Ä–∏–Ω–æ—Å–∏—Ç —É–¥–∞—á—É, —ç—Ç–æ –ø—Ä–∞–≤–¥–∞?¬ª',
      '¬´–ü–æ–∫–∞–∂–∏—Ç–µ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ –º–µ–¥–æ–µ–¥–∞ ‚Äî –∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ü–µ–Ω–µ.¬ª',
      '¬´–ú–∏—Å—Ç–µ—Ä –ì—Ä–µ–π –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞–ª –º–µ–¥–æ–µ–¥, —á—Ç–æ —Å–∫–∞–∂–µ—Ç–µ?.¬ª'
    ],
    ok:[
      '¬´–î–æ—Å—Ç–æ–π–Ω–æ. –û—Ñ–æ—Ä–º–ª—è–π—Ç–µ.¬ª',
      '¬´–°–æ–≥–ª–∞—Å–µ–Ω. –ë–µ—Ä—É.¬ª',
      '¬´–í—ã–≥–æ–¥–Ω–∞—è —Å–¥–µ–ª–∫–∞, –∑–∞–±–∏—Ä–∞—é..¬ª'
    ],
    no:[
      '¬´–í—ã –∏–∑–¥–µ–≤–∞–µ—Ç–µ—Å—å?¬ª',
      '¬´–í—ã –∏–∑–¥–µ–≤–∞–µ—Ç–µ—Å—å?¬ª',
      '¬´–í—ã –∏–∑–¥–µ–≤–∞–µ—Ç–µ—Å—å?¬ª'
    ],
    want:'panacea'
  }
};

/* –ü—É–ª—ã —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø–æ ¬´—Å—É—Ç–∏¬ª ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞ –≤—ã–±–æ—Ä (–ª—é–±–∞—è –∏–∑ –≥—Ä—É–ø–ø—ã –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è) */
const AD_POOL = {
  power: [
    '¬´–º–µ–¥–æ–µ–¥ –ø–æ–º–æ–≥–∞–µ—Ç —Ç—É–ª–∏—Ç—å—Å—è –¥–æ —Ä–∞—Å—Å–≤–µ—Ç–∞¬ª',
    '¬´–º–µ–¥–æ–µ–¥ –ª–æ–∂–∏—Ç—å –Ω–∞ –ø—É–∑–æ —à–µ—Ä–∏—Ñ–æ–≤ —à—Ç–∞–±–µ–ª—è–º–∏¬ª',
    '¬´–º–µ–¥–æ–µ–¥ –ø–æ–º–æ–≥–∞–µ—Ç –≤—É—Ä–¥–∞–ª–∞—á–∏—Ç—å –≤–¥–≤–æ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ¬ª'
  ],
  charisma: [
    '¬´–º–µ–¥–æ–µ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–∑–µ–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–¥–µ–∂–¥—É –∂–µ–Ω—â–∏–Ω—ã –≤–∑–≥–ª—è–¥–æ–º¬ª',
    '¬´–º–µ–¥–æ–µ–¥ ‚Äî –∂—É–π, –∂—É–π –∏ —á–ª–µ–Ω —Å—Ç–∞–Ω–µ—Ç –≤–¥–≤–æ–µ –±–æ–ª—å—à–µ¬ª',
    '¬´–º–µ–¥–æ–µ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∂—ë–Ω –¥–∞–∂–µ –Ω–µ —Å—Ç–∞–Ω–æ–≤—è—Å—å –º–æ—Ä–º–æ–Ω–æ–º¬ª'
  ],
  panacea: [
    '¬´–º–µ–¥–æ–µ–¥ ‚Äî –ª–µ—á–∏—Ç –æ—Ç –≤—Å–µ–≥–æ, —É–≤–µ—Ä—è—é¬ª',
    '¬´–º–µ–¥–æ–µ–¥ –ø—Ä–∏–Ω–æ—Å–∏—Ç –±–æ–≥–∞—Ç—Å—Ç–≤–æ –∏ —Å–ª–∞–≤—É!¬ª',
    '¬´–º–µ–¥–æ–µ–¥ –ø–æ–¥–∞—Ä–∏—Ç –≤–∞–º —Ö–∞—Ä–∏–∑–º—É –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º –¥–Ω–µ¬ª'
  ]
};

/* –°–æ—Å—Ç–æ—è–Ω–∏–µ */
const state = {
  cash:20, stock:START_STOCK, wins:0, victory:false,
  current:null, selectedAd:null,
  prices:{ vurdalak:22, social:14, arist:28 }
};

/* –£—Ç–∏–ª–∏—Ç—ã */
const $ = s=>document.querySelector(s);
const pick = a=>a[(Math.random()*a.length)|0];
function updateHeader(){
  $('#stock').textContent = state.stock;
  $('#cash').textContent = state.cash;
  $('#wins').textContent = state.wins;
  const pct = Math.min(100, Math.round((state.wins/10)*100));
  $('#winBar').style.width = pct+'%';
  $('#winHint').textContent = state.wins>=10 ? '–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!' : `–û—Å—Ç–∞–ª–æ—Å—å: ${Math.max(0,10-state.wins)}`;
}
function log(lines, cls){
  const box = $('#log');
  const el = document.createElement('div');
  el.className='item';
  if(cls==='ok') el.classList.add('ok');
  if(cls==='no') el.classList.add('no');
  el.innerHTML = lines.map(t=>`<div class="who">${t.who}</div><div>${t.text}</div>`).join('<div style="height:6px"></div>');
  box.prepend(el);
  while(box.children.length>20) box.removeChild(box.lastChild);
}

/* –ü—Ä–∏—ë–º –ø–∞—Ü–∏–µ–Ω—Ç–∞ */
function acceptPatient(){
  if(state.victory) return;
  if(state.stock<=0 && state.wins<10){ // –Ω–µ—Ç –∑–∞–ø–∞—Å–∞, —Ü–µ–ª—å –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
    log([{who:'–°–∏—Å—Ç–µ–º–∞',text:'–ó–∞–ø–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è —Ä–∞–Ω—å—à–µ —Ü–µ–ª–∏. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.'}],'no');
    return;
  }
  const ids = Object.keys(TYPES);
  const id = ids[(Math.random()*ids.length)|0];
  state.current = id; state.selectedAd = null;
  $('#btnSell').disabled = true;

  const t = TYPES[id];
  $('#portrait').textContent = t.emoji;
  $('#ptype').textContent = `–ü–∞—Ü–∏–µ–Ω—Ç: ${t.name}`;
  $('#prefs').textContent = '–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç: ' + t.likes.join(', ');
  $('#dialog').textContent = pick(t.greet);

  // —Å–æ–±—Ä–∞—Ç—å –Ω–∞–±–æ—Ä –æ–ø—Ü–∏–π: –ø–æ –æ–¥–Ω–æ–º—É —Å–ª—É—á–∞–π–Ω–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É –∏–∑ –∫–∞–∂–¥–æ–π ¬´—Å—É—Ç–∏¬ª
  const variants = [
    {id:'power', text: pick(AD_POOL.power)},
    {id:'charisma', text: pick(AD_POOL.charisma)},
    {id:'panacea', text: pick(AD_POOL.panacea)}
  ];
  // –ø–µ—Ä–µ–º–µ—à–∞–µ–º –ø–æ—Ä—è–¥–æ–∫
  variants.sort(()=>Math.random()-0.5);

  const box = $('#answers'); box.innerHTML='';
  variants.forEach(v=>{
    const idHtml = 'ad_'+v.id+'_'+Math.random().toString(36).slice(2,6);
    const lbl = document.createElement('label');
    lbl.className='answer';
    lbl.innerHTML = `<input type="radio" name="ad" id="${idHtml}" value="${v.id}"><span>${v.text}</span>`;
    lbl.querySelector('input').addEventListener('change', e=>{
      state.selectedAd = e.target.value;
      $('#btnSell').disabled = false;
    });
    // –∫–ª–∏–∫ –ø–æ –≤—Å–µ–π —Å—Ç—Ä–æ–∫–µ —Ç–æ–∂–µ –≤—ã–±–∏—Ä–∞–µ—Ç
    lbl.addEventListener('click', (ev)=>{
      const inp = lbl.querySelector('input');
      if(ev.target!==inp){ inp.checked = true; inp.dispatchEvent(new Event('change')); }
    });
    box.appendChild(lbl);
  });
}

/* –ü—Ä–æ–¥–∞–∂–∞ */
function sell(){
  if(state.victory) return;
  if(!state.current){ log([{who:'–°–∏—Å—Ç–µ–º–∞',text:'–°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–º–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞.'}]); return; }
  if(!state.selectedAd){ log([{who:'–°–∏—Å—Ç–µ–º–∞',text:'–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É —Ä–µ–∫–ª–∞–º—ã.'}]); return; }

  const t = TYPES[state.current];
  const isRightSence = (state.selectedAd === t.want);

  if(isRightSence){
    const price = state.prices[state.current] || 16;
    state.cash += price; state.stock = Math.max(0, state.stock-1); state.wins += 1;
    $('#dialog').textContent = pick(t.ok);

    // –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ª–æ–≥: ¬´–í—ã: –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞¬ª –∏ ¬´–ü–æ–∫—É–ø–∞—Ç–µ–ª—å: –æ—Ç–≤–µ—Ç¬ª
    const chosenText = [...document.querySelectorAll('#answers input[name="ad"]')].find(r=>r.checked)?.nextElementSibling?.textContent || '(–≤–∞—à–∞ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞)';
    const buyerReply = pick(t.ok);
    log([
      {who:'–í—ã', text: chosenText},
      {who:`${t.name}`, text: buyerReply},
      {who:'–ò—Ç–æ–≥', text:`–£—Å–ø–µ—Ö: +${price} ‚ÇΩ`}
    ], 'ok');

    // —Å–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ, –∂–¥—ë–º –Ω–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
    state.current = null;
    $('#ptype').textContent = '–ü–∞—Ü–∏–µ–Ω—Ç: ‚Äî';
    $('#prefs').textContent = '‚Äî';
    $('#answers').innerHTML = '';
    $('#btnSell').disabled = true;

  }else{
    const chosenText = [...document.querySelectorAll('#answers input[name="ad"]')].find(r=>r.checked)?.nextElementSibling?.textContent || '(–≤–∞—à–∞ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞)';
    const buyerReply = pick(t.no);
    $('#dialog').textContent = buyerReply;
    log([
      {who:'–í—ã', text: chosenText},
      {who:`${t.name}`, text: buyerReply},
      {who:'–ò—Ç–æ–≥', text:'–û—Ç–∫–∞–∑'}
    ], 'no');
  }

  updateHeader();
  checkVictory();
}

/* –ü–æ–±–µ–¥–∞ */
function checkVictory(){
  if(state.wins>=10 && !state.victory){
    state.victory = true;
    $('#btnReveal').disabled = false;
    log([{who:'–°–∏—Å—Ç–µ–º–∞',text:'üéâ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞: 10 —É–¥–∞—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂. –ù–∞–∂–º–∏—Ç–µ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ¬ª.'}],'ok');
  }else if(state.stock<=0 && state.wins<10){
    log([{who:'–°–∏—Å—Ç–µ–º–∞',text:'–ó–∞–ø–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è. –î–ª—è —Ü–µ–ª–∏ 10 —É—Å–ø–µ—Ö–æ–≤ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∏–≥—Ä—É (–æ–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É).'}],'no');
  }
}

/* –ü–æ—Å–ª–∞–Ω–∏–µ */
function openMessage(){
  if(!state.victory) return;
  $('#loveText').textContent = LOVE_MESSAGE;
  $('#modal').classList.add('show');
}

/* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è */
function init(){
  // —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  $('#stock').textContent = state.stock;
  $('#cash').textContent = state.cash;
  updateHeader();

  // —Å–æ–±—ã—Ç–∏—è
  $('#btnAccept').addEventListener('click', acceptPatient);
  $('#btnSell').addEventListener('click', sell);
  $('#btnReveal').addEventListener('click', openMessage);
  $('#close').addEventListener('click', ()=>$('#modal').classList.remove('show'));

  // –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
  document.addEventListener('keydown', e=>{
    if(e.code==='Enter'){ e.preventDefault(); acceptPatient(); }
    if(e.code==='Space'){ e.preventDefault(); sell(); }
  });
}
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
